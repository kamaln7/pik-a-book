<div ng-controller="EbooksController">
	<h2>Browse Latest E-books</h2>
	<div ng-show="!ebooks">
		<h4>Loading e-books..</h4>
	</div>

	<div ng-show="error" class="alert alert-danger">{{error}}</div>

	<button type="button" class="btn btn-info" id="top" ng-click="scrollTo('bottom')">go to
		the bottom</button>
	<hr>


	<div ng-repeat="book in ebooks" class="row">
		<div class="col-sm-1"></div>
		<div class="col-sm-10">
			<div class="panel panel-default">
				<div id="{{book.name}}" class="panel-heading">
					<h3 class="panel-title">{{ book.name }}</h3>
				</div>
				<div class="panel-body">
					<div class="row">
						<div class="col-sm-8">
							<p class="text-justify">{{ book.description }}</p>
						</div>
						<div class="col-sm-4 text-right">
							<img src="./books/{{ book.path }}/files/cover.jpg" class="img-rounded book-cover-small"
								alt="book cover">
						</div>
					</div>

					<button class="btn font-weight-bold btn-warning" type="button" ng-hide="state.user.is_admin"
						ng-class="{ 'active' : currentSection == 'admin' }">${{ book.price }}</button>

					<!-- likes -->
					<div class="inline-block">
						<div class="btn-group">
							<button ng-click="toggleLike($scope, book)" type="button" class="btn"
								ng-class="{'btn-primary' : state.authed}" ng-class="{'btn-primary' : state.authed}">
								<span class="glyphicon glyphicon-thumbs-up"></span> {{ state.authed ?
								(userHasLiked(book.likes, state.user.id) ? 'Dislike' : 'Like') : 'Likes' }}
							</button>
							<button class="dropdown-toggle btn" data-toggle="modal"
								data-target="#likesModal{{ book.id }}">
								<span class="badge" ng-class="{'btn-primary' : state.authed}">{{ book.likes.length }}</span>
								<span class="caret"></span>
							</button>
						</div>
						<div class="modal fade" tabindex="-1" role="dialog" id="likesModal{{ book.id }}">
							<div class="modal-dialog modal-sm" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">Ã—</span>
										</button>
										<h4 class="modal-title">Likes</h4>
									</div>
									<div class="modal-body">
										<ul class="list-group">
											<li class="list-group-item" ng-repeat="like in book.likes"
												data-ebook-id="{{ like.ebook_id }}" data-user-id="{{ like.user_id }}"><a href="#">
													<span ng-show="state.user.id == like.user_id" class="glyphicon glyphicon-user"></span>{{
													(state.user.id == like.user_id) ? ' ' : '' }}{{ like.user_nickname }}
											</a></li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- reviews -->
					<button type="button" class="btn btn-info" data-toggle="collapse"
						data-target="#reviews{{ book.id }}">
						Reviews <span class="badge">{{ book.reviews.length }}</span>
					</button>

					<div id="reviews{{ book.id }}" class="collapse">
						<h3>Reviews</h3>
						<div ng-repeat="review in book.reviews">
							<div class="media">
								<div class="media-left">
									<img class="media-object user-icon" src="{{ review.user_photo || './user_icon.png' }}">
								</div>
								<div class="media-body">
									<h4 class="media-heading">{{ review.user_nickname }}</h4>
									<p class="text-justify">{{ review.content }}</p>
								</div>
							</div>
							<br ng-show="!last">
						</div>
					</div>


					<!-- -READING -->
					<button type="button" class="btn btn-success" data-toggle="collapse"
						data-target="#read{{book.id}}" ng-show="{{state.authed}}">Read</button>
					<div id="read{{book.id}}" class="collapse">
						<hr>
						<div class="embed-responsive embed-responsive-16by9">
							<iframe src="./books/A-Apple-Pie,-by-Kate-Greenaway/ebook.html" width="200px"
								ng-show="{{state.authed}}"></iframe>
						</div>

					</div>




				</div>
			</div>
		</div>
	</div>
	<div class="col-sm-1"></div>
	<hr>


	<button id="bottom" type="button" class="btn btn-info" ng-click="scrollTo('top')">go to
		the top</button>
</div>